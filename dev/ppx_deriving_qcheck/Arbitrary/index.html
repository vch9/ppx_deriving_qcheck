<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Arbitrary (ppx_deriving_qcheck.Arbitrary)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 1.5.3"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">ppx_deriving_qcheck</a> &#x00BB; Arbitrary</nav><h1>Module <code>Arbitrary</code></h1><p>Module expanding a type declaration with a QCheck.arbitrary</p></header><dl><dt class="spec type" id="type-ty"><a href="#type-ty" class="anchor"></a><code><span class="keyword">type</span> ty</code><code> = string</code></dt><dt class="spec type" id="type-env"><a href="#type-env" class="anchor"></a><code><span class="keyword">type</span> env</code><code> = </code><code>{</code><table class="record"><tr id="type-env.ty" class="anchored"><td class="def field"><a href="#type-env.ty" class="anchor"></a><code>ty : <a href="index.html#type-ty">ty</a>;</code></td><td class="doc"><p>current type under translation</p></td></tr><tr id="type-env.mutual_types" class="anchored"><td class="def field"><a href="#type-env.mutual_types" class="anchor"></a><code>mutual_types : <span><a href="index.html#type-ty">ty</a> list</span>;</code></td><td class="doc"><p>list of mutual types for the current type</p></td></tr><tr id="type-env.recursives_types" class="anchored"><td class="def field"><a href="#type-env.recursives_types" class="anchor"></a><code>recursives_types : <span><a href="index.html#type-ty">ty</a> list</span>;</code></td><td class="doc"><p>list of recursives types, when mutual_types = <code></code> the only type that might be recursive is <code>ty</code></p></td></tr></table><code>}</code></dt></dl><dl><dt class="spec value" id="val-env"><a href="#val-env" class="anchor"></a><code><span class="keyword">val</span> env : <a href="index.html#type-ty">ty</a> <span>&#45;&gt;</span> <a href="index.html#type-env">env</a></code></dt><dd><p><code>env ty</code> creates default environment with <code>ty</code> inside.</p></dd></dl><dl><dt class="spec value" id="val-from_core_type"><a href="#val-from_core_type" class="anchor"></a><code><span class="keyword">val</span> from_core_type : <span>loc:Ppxlib.location</span> <span>&#45;&gt;</span> <span>env:<a href="index.html#type-env">env</a></span> <span>&#45;&gt;</span> Ppxlib.core_type <span>&#45;&gt;</span> Ppxlib.expression</code></dt><dd><p><code>from_core_type loc env ct</code> transforms <code>ct</code> into a QCheck.arbitrary</p><p>We distinguish two cases:</p><ul><li><p>A specific arbitrary is passed throught attribute:</p><pre><code class="ml">type t =
| Day of int [@arb QCheck.(map (fun x -&gt; Day x) (0--31))] 
| Month of int
| Year of int
[@@deriving arb]</code></pre></li><li>The arbitrary is derived from the core_type</li></ul></dd></dl><dl><dt class="spec value" id="val-from_arrow"><a href="#val-from_arrow" class="anchor"></a><code><span class="keyword">val</span> from_arrow : <span>loc:Ppxlib.location</span> <span>&#45;&gt;</span> <span>env:<a href="index.html#type-env">env</a></span> <span>&#45;&gt;</span> <span>(Ppxlib.core_type * Ppxlib.core_type)</span> <span>&#45;&gt;</span> Ppxlib.expression</code></dt><dd><p><code>from_arrow loc env (left, right)</code> transform a function type to a QCheck.arbitrary.</p><p>TODO: this should be more documented</p></dd></dl><dl><dt class="spec value" id="val-from_ptyp_variant"><a href="#val-from_ptyp_variant" class="anchor"></a><code><span class="keyword">val</span> from_ptyp_variant : <span>loc:Ppxlib.location</span> <span>&#45;&gt;</span> <span>env:<a href="index.html#type-env">env</a></span> <span>&#45;&gt;</span> <span>Ppxlib.row_field list</span> <span>&#45;&gt;</span> Ppxlib.expression</code></dt><dd><p><code>from_ptyp_variant loc env variant</code> create a QCheck.arbitrary from the body of a Ptyp_variant inside <code>variant</code></p><p>TODO: comment that function, it's really similar to a constructor declaration list.</p></dd></dl><dl><dt class="spec value" id="val-from_type_kind"><a href="#val-from_type_kind" class="anchor"></a><code><span class="keyword">val</span> from_type_kind : <span>loc:Ppxlib.location</span> <span>&#45;&gt;</span> <span>env:<a href="index.html#type-env">env</a></span> <span>&#45;&gt;</span> Ppxlib.type_kind <span>&#45;&gt;</span> <span>Ppxlib.expression option</span></code></dt><dd><p><code>from_type_kind loc env type_kind</code> creates a QCheck.arbitrary from the type description inside type_kind</p><ul><li><code>type kind</code> is a record, we use <a href="index.html#val-from_record"><code>from_record</code></a></li><li><code>type kind</code> is a variant, we use <a href="index.html#val-from_variant"><code>from_variant</code></a></li><li>Otherwise we return None because the arbitrary could not be derived.</li></ul></dd></dl><aside><p>Transform a record into a record QCheck.arbitrary</p></aside><dl><dt class="spec value" id="val-from_record"><a href="#val-from_record" class="anchor"></a><code><span class="keyword">val</span> from_record : <span>loc:Ppxlib.location</span> <span>&#45;&gt;</span> <span>env:<a href="index.html#type-env">env</a></span> <span>&#45;&gt;</span> <span>Ppxlib.label_declaration list</span> <span>&#45;&gt;</span> Ppxlib.expression</code></dt><dd><p><code>from_record loc env label_decls</code> create a QCheck.arbitrary using the record's description inside <code>label_decls</code></p><p>For each label_declaration, we create an arbitrary as an expression. These arbitraries are passed to <span class="xref-unresolved" title="unresolved reference to &quot;Types_helper.record&quot;"><code>Types_helper</code>.record</span>.</p></dd></dl><dl><dt class="spec value" id="val-from_tuple"><a href="#val-from_tuple" class="anchor"></a><code><span class="keyword">val</span> from_tuple : <span>loc:Ppxlib.location</span> <span>&#45;&gt;</span> <span>env:<a href="index.html#type-env">env</a></span> <span>&#45;&gt;</span> <span>Ppxlib.core_type list</span> <span>&#45;&gt;</span> Ppxlib.expression</code></dt><dd><p><code>from_tuple loc env cts</code> translate every core_type inside <code>cts</code> and build a tuple QCheck.arbitrary using <span class="xref-unresolved" title="unresolved reference to &quot;Types_helper.tuple&quot;"><code>Types_helper</code>.tuple</span></p></dd></dl><dl><dt class="spec value" id="val-from_variant"><a href="#val-from_variant" class="anchor"></a><code><span class="keyword">val</span> from_variant : <span>loc:Ppxlib.location</span> <span>&#45;&gt;</span> <span>env:<a href="index.html#type-env">env</a></span> <span>&#45;&gt;</span> <span>Ppxlib.constructor_declaration list</span> <span>&#45;&gt;</span> Ppxlib.expression</code></dt><dd><p><code>from_variant loc env constrs</code> create a QCheck.arbitrary for the constructors in <code>constrs</code>.</p><p>We distinguish two cases:</p><ul><li><p>The type is self recursive</p><pre><code class="ml">type tree = Leaf | Node of int * tree * tree</code></pre></li></ul><p>The distinction betweens recursive nodes and leaves must be considered in order to avoid a infinite loop on a recursive type</p><ul><li><p>The type is a list of constructor</p><pre><code class="ml">type color = Green | Blue | Red | Any of int</code></pre></li></ul><p>We just have to chose one of the constructors built using <a href="index.html#val-from_constructor_decl"><code>from_constructor_decl</code></a>.</p></dd></dl><dl><dt class="spec value" id="val-from_constructor_decl"><a href="#val-from_constructor_decl" class="anchor"></a><code><span class="keyword">val</span> from_constructor_decl : <span>loc:Ppxlib.location</span> <span>&#45;&gt;</span> <span>env:<a href="index.html#type-env">env</a></span> <span>&#45;&gt;</span> Ppxlib.constructor_declaration <span>&#45;&gt;</span> <span>Ppxlib.expression option</span> * Ppxlib.expression</code></dt><dd><p><code>from_constructor_decl loc env cd</code> returns the pair (weight option * arbitrary) for <code>cd</code>.</p><p>Weight is the optional frequency of the arbitrary in a <code>QCheck.frequency</code> as constructor declaration might often be inside a list of declaration</p></dd></dl><dl><dt class="spec value" id="val-from_type_declaration"><a href="#val-from_type_declaration" class="anchor"></a><code><span class="keyword">val</span> from_type_declaration : <span>loc:Ppxlib.location</span> <span>&#45;&gt;</span> <span>?&#8288;env:<a href="index.html#type-env">env</a></span> <span>&#45;&gt;</span> Ppxlib.type_declaration <span>&#45;&gt;</span> Ppxlib.structure_item</code></dt><dd><p><code>from_type_declaration loc env td</code> translate a type_declaration <code>td</code> into the according QCheck.arbitrary</p><pre><code class="ml">type t = (* type_declaration *)
[@@deriving arb]

(* ==&gt; *)

let arb : t QCheck.arbitrary = (* t arbitrary *)</code></pre><p><code>env</code> can either be passed from <a href="index.html#val-from_type_declarations"><code>from_type_declarations</code></a> with additionals information. Otherwise, <code>from_type_declaration</code> will build it's own environment.</p></dd></dl><dl><dt class="spec value" id="val-from_type_declarations"><a href="#val-from_type_declarations" class="anchor"></a><code><span class="keyword">val</span> from_type_declarations : <span>loc:Ppxlib.location</span> <span>&#45;&gt;</span> <span>Ppxlib.type_declaration list</span> <span>&#45;&gt;</span> Ppxlib.structure_item</code></dt><dd><p><code>from_type_declarations loc tds</code> translate every type_declaration in <code>tds</code> using <a href="index.html#val-from_type_declaration"><code>from_type_declaration</code></a>.</p><p>List of type_declaration comes from a mutual recursive type:</p><pre><code class="ml">type expr =
| If of expr * expr * expr
| Assign of char * expr
| Value of value

and value =
| Int of int
| Bool of bool [@@deriving arb]

(* ==&gt; *)

let arb_expr () = (* expr arbitrary *)
and arb_expr = arb_expr ()
and arb_value () = (* value arbitrary *)
and arb_value = arb_value ()</code></pre></dd></dl></div></body></html>